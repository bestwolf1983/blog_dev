---
title: 经历一次P2事故，以及自己的反思
date: 2018-02-22 22:09:00
tags:
---
 2018年初，所在部门发生了一起影响面比较大的事故，自己做为事故的亲身经历者之一，从头到尾经历了整个事件的经过，参加了事故的数次复盘，收获良多。滴滴就是这样的一家公司，做一年，能够让你经历在别的公司做十年都不会经历的事情这样的经历，经历了一次，自然要把经验教训仔细的记录下来，不然怎么对得起这昂贵不菲的学费。
## 事故的发生，暴漏的是人性弱点
事后，部门老大专门给大家组了一个会复盘。  
这是一次让我非常震撼的会议，参会的很多人都是正处在风口浪尖上的人，压力最大的是部门老大，他已经经历了几个不眠之夜:事故善后，数次复盘（包括和CTO复盘)，还能再和部门的基层管理者做复盘，老大可以说是用心良苦。会议前，内网上一篇置顶的帖子，把地图事业部说的一无是处(林子大了什么鸟都有，内网上的键盘侠和社会上一样多)，人言可畏,好像要平民愤似的，部门老大就被通报罚款了10万元人民币，
会议刚开始，老大就抛出来一个问题：“如果这次会是一节课，同学们说这节课价值多少钱?”,随后自问自答道：“这节课价值10万元，如果加上对用户造成的影响，对公司声誉造成的损失，价值上百万元”。
接着，老大又娓娓道来，讲述了自己在事故发生后的总结感悟。

首先，他谈到了人的侥幸心理，谈到了[墨菲定律](https://baike.baidu.com/item/%E5%A2%A8%E8%8F%B2%E5%AE%9A%E5%BE%8B)，接着，他还谈到了这次事故自己悟到的一些经验教训，我当时记录下的有：
地图作为一个后台支持技术部门，对待事故的反应速度不够迅速，打个比方，有点儿像打仗的时候，一支后勤机关，突然被敌人扔了一颗大炸弹，所有人第一反应都有点儿懵，事故的善后工作做的不够及时，反应速度不如一线部队那么迅速。随着地图在公司承担越来越多的线上服务，要求我们要对线上服务有足够的/*敏锐*/。
- 线上问题要及时查，深入查，一查到底，等到老板反馈问题，那说明问题已经很严重了，而我们部门反馈问题最多的恰恰是部门老大。(一方面说明部门老大确实很勤奋，一方面说明我们的业务成熟度确实还很弱)
- 面对事故后别人的指责，忘掉80%不是你的问题，去解决20%的问题。(这个主要说的是善后的邮件，另外还提到事故邮件要星辰花这样的公司第三方部门来发）
- 2018年提供的服务，要给用户一致的预期，比如说ETA，一直准或者一直有规律的不准(比如偏短）都好过有时候准，有时候不准；有时候偏长，有时候偏短。要看方差，不要看均值。(还是说的服务质量，对于恶劣的bad case，杀伤力比统计意义上更强，人都是感性思考的动物，更相信自己直觉上感受到的）
- 实时监控一级指标，要在办公区上墙。（这个也是互联网公司的通用做法了，说起来简单，想做好了不简单，技术上如数据清洗，TraceId，ELK，大数据存储，数据一致性等等技术难点，其实是对一家互联网公司综合业务成熟度的考验，这个也是我们组2018年工作重点内容之一，也有布局，可以单独拿出来写一篇文章）

人类的行为是由人类的天性决定的。侥幸心理的背后是懒惰和短视，只注重短期指标，对短期看不到效益的项目，例如代码重构和架构升级，没有专门投入人力去做。项目立项，都是从业务、从功能的角度来设定项目目标，产品经理写项目上线通告，写的都是能对业务线带来多少收益，写能为公司多赚多少钱，节约多少经费。然而修炼内功这种事儿，虽然口号喊的很响，但是却是不太好讲故事的。从这个角度来说，一次事故是很好的PR，让局外人更深刻的意识到技术稳定的重要性，只是这个PR的费用未免也过于昂贵了些。所以孙子兵法曰：故善战者之胜也，无智名，无勇功。孙子兵法强调，那些善于打胜仗的将军们，用的不是什么高深的计谋，也不是什么过人的勇气，他打的都是一定会赢的仗，功夫都下在平时，没有什么赫赫战功，他的功劳甚至只有自己才知道。所以，领导者的眼光，领导者是不是一个明察秋毫的人，其实还是很重要的。

事故以后，和当时执行错误操作，直接触发了事故的那位同学聊天，这位同学很早加入公司，以前在百度做了很多年的运维，有很丰富的大规模集群服务运维经验。这位同学表示：“上数据这件事儿，每次都是我来上，上了三年没出过事儿，这次终于出事儿了”。三年的时间，无数能够改进架构的机会都被错过了，最宝贵的人力，被放在业务，放在牛逼的效果上，比如把深度学习技术用在路径规划，这样的创新上。上数据这么苦逼的事儿，就由资深运维大神手动搞一搞，似乎短时间也是可以的嘛。资深大神也有犯错的时候，不客气的说，是人就会犯错。管理层怎么能寄希望于人不犯错上？这是管理层犯的致命错误:
- 地图业务自动化程度很低，需要专业运维人员上线服务，更新数据。
- 地图部门没有专职运维，基础架构部门支持地图的一名全职同学，也不认为自己是运维，更倾向于开发工具帮助RD自助上线，但是成熟度还不够。
- 地图的运维是缺失的，全靠RD顶着，技术能力又没有自动化，大量操作靠人工，RD内心是不情愿的。
- 终于有一天，负责更新数据的同学敲下了错误的指令。

所以，站在管理层的角度看，管理层也处于两难的境地：建设一个专业的运维团队，技术成本低，见效快，但却是在走以前的老路子，技术上没有创新，主流互联网公司正在替代为更具自动化的技术方案；走自动化运维的路子，技术投入大，短期看不到收益，对地图的主流业务似乎没有直接的帮助。管理者比较倾向于高风险高回报的短期战略，所以对运维的投入采取了鸵鸟政策，视而不见，当问题不存在。既没有专业运维，也没有投入力量做自动化运维。

## 事故的深层次原因
公司自上而下，比较急功近利，这个应该是近些年涌现的互联网创业公司的通病：/*拿了投资人的钱，短期内如果不能有很好的业绩表现，管理层会面临比较大的压力。*/

然而，地图看起来又是一个比较传统的技术方向，电子地图图商如高德，技术上已经有10多年的技术储备，又经历了和百度地图打仗的炮火洗礼，又有阿里亲爹的大棒+金元，可谓兵强马壮。但是，我司地图部门存在的大前提就是我们必须比市面上的电子地图公司都强，否则就失去了我们存在的意义。
在这种背景下，地图的大老板其实是不太注重稳定性建设这样的指标，表面上的重视也只不过是开会给大家敲敲边鼓，没有实质性的动作，比如健全地图数据编译上线的中间件技术栈，这个是没有的。用的都还是10年前的技术思路。

## 关于稳定性和传统运维
管理大师德鲁克写过：
> 好的工厂环境就是应该看起来死气沉沉的，突发事件和由此涌现的英雄人物似乎很热闹，但从组织的角度来看是效率低下的。
这段话曾被海尔的董事长张明敏引用过。据说当时给他以非常深刻的印象。

其实传统的电子地图行业，就有点儿像是劳动密集型的制造业，地图是对真实世界的抽象，真实世界是复杂的，电子地图也很难用简单的统一模型去抽象真实世界。一次全国数据更新，有发版，质检，上线等若干个环节。每个环境都有大量人工参与，而且人工参与的关键环节的一个小失误，有可能导致全局性的后果。所以，短期搞好稳定性，要靠制度，要靠对人的管理。

## 关于自动化运维
让我想起了一则新闻，Google在路测无人车时发现的问题:  
原本Google的无人车上面，都是有Google无人车团队自己的路测员工的，但是后来发现，这些员工表现的并没有达到预期，他们在车上发短信，走神，打瞌睡；未能起到为机器保底的作用。所以waymo管理层做了一个决策，Waymo[在今年11月的时候推出了没有人类驾驶者的无人测试车](https://www.theverge.com/2017/11/7/16615290/waymo-self-driving-safety-driver-chandler-autonomous)，在亚利桑那州凤凰城一个叫Chandler的区域，进行路测。虽然路测的第一阶段，Waymo的员工会坐在车子里（后排），但是在一个很短时间的测试周期后，Waymo就准备推出完全无人的测试车队。比起频出状况的人类安全员，Waymo的管理层显然更相信机器的可靠性。
所以，现代互联网公司都很重视自动化运维，硅谷已经没有运维工程师（OP-Operator)这样一个职位，取而代之的是更有创造力的SRE（Site Reliability Engineering)。

## 写在最后的总结
现代社会的一大特点，就是分工越来越细，现代企业间的竞争，是技术的竞争，拼的是技术背后的人。一次严重的事故，暴漏的是管理能力的不足，战略投入的偏差，而不是具体分工的人。让我们脚踏实地，做好本职工作，同时也别忘了仰望星空。

最后祝大家2018年工作上事业上都能有所斩获，一切顺利！
